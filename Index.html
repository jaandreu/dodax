<!doctype html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">

    <title>XADOD</title>
    <style>

      .base {
        display: none;
      }

      @-webkit-keyframes spinAround{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes spinAround{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.pageloader{bottom:0;left:0;position:absolute;right:0;top:0}.pageloader{position:fixed;padding-top:2em;background:#00d1b2;background:#00d1b2;z-index:999998;transition:transform .35s ease-out,-webkit-transform .35s ease-out;will-change:transform}.pageloader.is-white{background-color:#fff;background:#fff}.pageloader.is-white::after{border-color:#0a0a0a;-webkit-animation:loader-figure-white 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-white 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-white .title{color:#0a0a0a}.pageloader.is-black{background-color:#0a0a0a;background:#0a0a0a}.pageloader.is-black::after{border-color:#fff;-webkit-animation:loader-figure-black 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-black 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-black .title{color:#fff}.pageloader.is-light{background-color:#f5f5f5;background:#f5f5f5}.pageloader.is-light::after{border-color:#363636;-webkit-animation:loader-figure-light 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-light 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-light .title{color:#363636}.pageloader.is-dark{background-color:#363636;background:#363636}.pageloader.is-dark::after{border-color:#f5f5f5;-webkit-animation:loader-figure-dark 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-dark 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-dark .title{color:#f5f5f5}.pageloader.is-primary{background-color:#00d1b2;background:#00d1b2}.pageloader.is-primary::after{border-color:#fff;-webkit-animation:loader-figure-primary 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-primary 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-primary .title{color:#fff}.pageloader.is-link{background-color:#3273dc;background:#3273dc}.pageloader.is-link::after{border-color:#fff;-webkit-animation:loader-figure-link 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-link 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-link .title{color:#fff}.pageloader.is-info{background-color:#209cee;background:#209cee}.pageloader.is-info::after{border-color:#fff;-webkit-animation:loader-figure-info 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-info 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-info .title{color:#fff}.pageloader.is-success{background-color:#23d160;background:#23d160}.pageloader.is-success::after{border-color:#fff;-webkit-animation:loader-figure-success 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-success 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-success .title{color:#fff}.pageloader.is-warning{background-color:#ffdd57;background:#ffdd57}.pageloader.is-warning::after{border-color:rgba(0,0,0,.7);-webkit-animation:loader-figure-warning 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-warning 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-warning .title{color:rgba(0,0,0,.7)}.pageloader.is-danger{background-color:#ff3860;background:#ff3860}.pageloader.is-danger::after{border-color:#fff;-webkit-animation:loader-figure-danger 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure-danger 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader.is-danger .title{color:#fff}.pageloader:not(.is-bottom-to-top){-webkit-transform:translateY(-100%);transform:translateY(-100%)}.pageloader.is-bottom-to-top{-webkit-transform:translateY(100%);transform:translateY(100%)}.pageloader.is-left-to-right{-webkit-transform:translateX(-100%);transform:translateX(-100%)}.pageloader.is-right-to-left{-webkit-transform:translateX(100%);transform:translateX(100%)}.pageloader.is-active:not(.is-left-to-right),.pageloader.is-active:not(.is-right-to-left){-webkit-transform:translateY(0);transform:translateY(0)}.pageloader.is-active.is-left-to-right,.pageloader.is-active.is-right-to-left{-webkit-transform:translateX(0);transform:translateX(0)}.pageloader::after{position:absolute;top:50%;left:50%;display:block;border-radius:100%;content:'';z-index:9999;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);width:0;height:0;box-sizing:border-box;border:0 solid #fff;-webkit-animation:loader-figure 1.15s infinite cubic-bezier(.215,.61,.355,1);animation:loader-figure 1.15s infinite cubic-bezier(.215,.61,.355,1)}.pageloader .title{position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);margin:2em 0 0 0;font-size:.875em;letter-spacing:.1em;line-height:1.5em;color:#fff;white-space:nowrap}@-webkit-keyframes loader-figure{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-white{0%{height:0;width:0;background-color:#0a0a0a}29%{background-color:#0a0a0a}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-white{0%{height:0;width:0;background-color:#0a0a0a}29%{background-color:#0a0a0a}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-black{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-black{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-light{0%{height:0;width:0;background-color:#363636}29%{background-color:#363636}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-light{0%{height:0;width:0;background-color:#363636}29%{background-color:#363636}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-dark{0%{height:0;width:0;background-color:#f5f5f5}29%{background-color:#f5f5f5}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-dark{0%{height:0;width:0;background-color:#f5f5f5}29%{background-color:#f5f5f5}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-primary{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-primary{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-link{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-link{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-info{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-info{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-success{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-success{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-warning{0%{height:0;width:0;background-color:rgba(0,0,0,.7)}29%{background-color:rgba(0,0,0,.7)}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-warning{0%{height:0;width:0;background-color:rgba(0,0,0,.7)}29%{background-color:rgba(0,0,0,.7)}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@-webkit-keyframes loader-figure-danger{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}@keyframes loader-figure-danger{0%{height:0;width:0;background-color:#fff}29%{background-color:#fff}30%{height:2em;width:2em;background-color:transparent;border-width:1em;opacity:1}100%{height:2em;width:2em;border-width:0;opacity:0;background-color:transparent}}
      
      .pageloader{
        background-color: black;
        opacity: 70%;
      }
      div.navbar-menu {
        background-color: #f16130;
      }
      span.discogs {
        vertical-align: middle;
        padding-left: 2px;
      }
      
      .flexgrow {
        flex-grow: 1;
      }
      .naranja {
        color: #f16130;
      }
    </style>

</head>
<body class="has-navbar-fixed-top">
  <!--Navbar (buscador)-->
  <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
    <div class="navbar-menu is-active">
      <div class="navbar-start flexgrow">
        <div class="navbar-item flexgrow">
          <div class="container">
            <div class="columns">
              <div class="column">
                <form id="formulario" method='GET' action='javascript:void(0); return false;'>
                  <div class="field has-addons">
                    <div class="control flexgrow">
                      <input class="input is-large is-info is-expanded" id="search" type="text"
                        placeholder="last shadow puppets ...">
                    </div>
                    <div class="control">
                      <button type="submit" class="button is-info is-large"> <i class="fas fa-search"></i></button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- Loading -->
  <div id="div-pageloader" class="pageloader"><span class="title">Buscando...</span></div>

  <section class="section">

    <!-- Container para las fichas de resultados.-->
    <div class="container">
      <div id="div-resultados" class="columns resultados is-multiline">
        <div class=" base column is-one-quarter is-half-tablet">
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img class="cover" src="" alt="Album cover">
              </figure>
            </div>
            <div class="card-content">
              <div class="media">
                <div class="media-content">
                  <p class="album title is-4"></p>
                  <p class="artist subtitle is-6"></p>
                </div>
              </div>
              <div class="content">
                <div class="table-container">
                  <table class="table is-hoverable is-fullwidth">
                    <tbody>
                      <!-- Items con los precios-->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <article id="div-info" class="message is-info">
        <div class="message-header">
          <p>Ayuda</p>
        </div>
        <div class="message-body">
          <ul>
            <li>- La búsqueda está limitada a 50 resultados.</li>
            <li>- Sólo busca vinilos, no hace falta poner <b>VINILO</b>, <b>VINYL</b> ni <b>LP</b>.</li>
            <li>- Se puede introducir tanto el ID de DODAX como el código de barras del disco para que realice la búsqueda.</li>
            <li>- A partir del resultado se puede acceder al detalle del disco en Dodax o a Discogs pulsando sobre el icono con forma de vinilo.</li>
            <li>- El icono de la estrella representa los mejores precios.</li>
          </ul>
        </div>
      </article>

      <!--Mensaje para no se han encontrado datos-->
      <div style="display: none;" id="div-noresult" class="noresult notification is-info">
        No se han encontrado coincidencias
      </div>

    </div>

  </section>

  <!-- Sripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
  </script>
  
  <script defer src="https://use.fontawesome.com/releases/v5.14.0/js/all.js"></script>
  
  <script>

    //Método que muestra u oculta el frame de buscando.
    const showSpinner = function (show) {

      if (show)
        addClass("div-pageloader", "is-active");  
      else
        removeClass("div-pageloader", "is-active");  

    }

    //Listado de servidores a los que consultaremos.
    var urlsDodax = [{
      text: "DE",
      url: "https://www.dodax.de",
      params: "/de-de/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "AT",
      url: "https://www.dodax.at",
      params: "/de-at/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "FR",
      url: "https://www.dodax.fr",
      params: "/fr-fr/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "UK",
      url: "https://www.dodax.co.uk",
      params: "/en-gb/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "ES",
      url: "https://www.dodax.es",
      params: "/es-es/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "IT",
      url: "https://www.dodax.it",
      params: "/it-it/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "PL",
      url: "https://www.dodax.pl",
      params: "/pl-pl/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }, {
      text: "NL",
      url: "https://www.dodax.nl",
      params: "/nl-nl/musik-cds-dvds-vinyl-cLOFV6FFU7H-f-lpvinyl-K6IQQ1BLV9/?s="
    }]

    //Proxy para evitar el CORS
    const proxyurl = window.location.host.includes('netlify') ? "https://dodax-proxy.herokuapp.com/" : "https://cors-anywhere.herokuapp.com/";
    const ownerDocument = document.implementation.createHTMLDocument('virtual');

    //Funciones auxiliares DOM
    const showElement = function(idElement){
       var elem = document.getElementById(idElement);
       if (elem != null) {
         elem.style.display = "";
       }
    }

    const hideElement = function(idElement){
       var elem = document.getElementById(idElement);
       if (elem != null) {
         elem.style.display = "none";
       }
    }

    const addClass = function(idElement, className){
       var elem = document.getElementById(idElement);
       if (elem != null) {
        elem.classList.add(className)
       }
    }

    const removeClass = function(idElement, className){
       var elem = document.getElementById(idElement);
       if (elem != null) {
        elem.classList.remove(className)
       }
    }


    //Obtiene un JSON con los rates de las monedas en base al EUR.
    const getCurrencyRates = async (url) => {

      let response = await fetch("https://api.exchangeratesapi.io/latest");
      let data = await response.json();
      return data;

    }

    //Obtiene un importe en euros.
    const getPrice = function (price, codigo) {
      if (rates != null) {

        switch (codigo) {
          case "UK":
            salida = (parseFloat(price.replace(",", ".")) * (1 / rates.rates["GBP"])).toFixed(2);
            break;
          case "PL":
            salida = (parseFloat(price.replace(",", ".")) * (1 / rates.rates["PLN"])).toFixed(2);
            break;
          default:
            salida = parseFloat(price.replace(",", ".")).toFixed(2);
        }
      } else {
        salida = parseFloat(price.replace(",", ".")).toFixed(2);
      }
      return salida;
    }

    //Obtiene el caracter de moneda en función del código de pais.
    const getCurrency = function (price, codigo) {
      var salida = "";
      switch (codigo) {
        case "UK":
          salida = price + " £";
          break;
        case "PL":
          salida = price + " zł";
          break;
        default:
          salida = "";

      }
      return salida;
    }
  
    //Devuelve la información de los albums de una url de Dodax.
    const getDodaxAlbums = async (url) => {

      console.log("Conectando:" + url);
      let response = await fetch(url);
      let data = await response.text();
      return data;

    }

    //Invoca a todas las urls de Dodax al mismo tiempo para obtener su información.
    const getDodaxSitesAlbums = async (urls, cadenaBusqueda, items) => {

      const requests = urls.map((urlDodax) => {


        if (urlDodax.text === "ES")
          cadenaBusqueda = cadenaBusqueda.toUpperCase().replace("VINYL", "VINILO");
        else
          cadenaBusqueda = cadenaBusqueda.toUpperCase().replace("VINILO", "VINYL");

        const urlCompleta = proxyurl + urlDodax.url + urlDodax.params + cadenaBusqueda + "&paginating=true&f=" +
          items;

        return getDodaxAlbums(urlCompleta)
          .then((salida) => {

            const $lineas = $(salida, ownerDocument).find("div.product");
            urlDodax.html = $lineas;

            return urlDodax;
          });

      })

      return Promise.all(requests)
    }

    //Variables globales.
    var discos = []
    var rates = null;
    var limiteAlcanzado = false;

    //Obtiene los albums que coinciden con la cadena de búsqueda, a partir de n items (es paginado.)
    const getAlbums = function (urlsDodax, cadenaBusqueda, items) {

      getDodaxSitesAlbums(urlsDodax, cadenaBusqueda, items)
        .then(content => {

          var nextUrlDodax = [];

          content.forEach(resultado => {

            if (resultado.html.length == 12 && !limiteAlcanzado) {
              nextUrlDodax.push(resultado);
            }

            resultado.html.each(function () {

              var obj = {};
              var idAlbum = $(this).find('a.js-product').attr('id');

              var encontrado = false;
              var indexEncontrado = -1;

              $.each(discos, function (index, value) {
                if (value.id == idAlbum) {
                  indexEncontrado = index;
                  encontrado = true;
                  return false;
                }
              });

              var precio = $(this).find('a.buy-button span').text()
                .replace("€", "")
                .replace("£", "")
                .replace("zł", "")
                .replace(".", ",")
                .replace(" ", "")
                .replace(String.fromCharCode(160), "")
                .replace("&nbsp;", "");
              
              var $gtin =   $(this).find("a.buy-button").attr("onmousedown");

              var precioObj = {
                url: resultado.url + $(this).find('a.js-product').attr('href'),
                price: getPrice(precio, resultado.text).replace(".", ","),
                priceInt: getPrice(precio, resultado.text),
                priceOriginal: getCurrency(precio, resultado.text),
                currency: "€",
                text: resultado.text,
              };

              if (encontrado) {
                discos[indexEncontrado].prices.push(precioObj);

                if ($gtin != null && discos[indexEncontrado].gtin === ""){
                  discos[indexEncontrado].gtin = $gtin.replace("RetailRocket.addToCartRetailRocket('", "").replace("');", "");
                }

                if (parseFloat(discos[indexEncontrado].minPrice) > parseFloat(precioObj.priceInt)) {
                  discos[indexEncontrado].minPrice = precioObj.priceInt;
                }

              } else {

                obj.id = idAlbum;
                obj.image = $(this).find('img').attr('src');
                obj.title = $(this).find('p.product_title').text();
                obj.from = $(this).find('p.product_from').text();
                obj.type = $(this).find('p.product_type').text();
                obj.prices = []
                obj.prices.push(precioObj)
                obj.minPrice = precioObj.priceInt;
                obj.gtin = $gtin != null ? $gtin.replace("RetailRocket.addToCartRetailRocket('", "").replace("');", "") : "";

                discos.push(obj);

              }
            });

          });

          limiteAlcanzado = discos.length > 50;

          if (nextUrlDodax.length > 0) {
            getAlbums(nextUrlDodax, cadenaBusqueda, items + 12);
          } else {
            if (discos.length == 0)
              showElement("div-noresult");
            else {
              hideElement("div-noresult");
              $.each(discos, function (index, value) {
                var $base = $(".base").clone().removeClass("base").addClass("resultados-items");
                $base.find("p.album").html("<span style='padding-right:4px;'>" + value.title + "</span>" + (
                    value.type !== "" ? "<span class='tag is-info is-rounded'>" + value.type + "</span>" : ""
                    ) + (value.gtin !== "" ? "<span class='discogs'><a href='https://www.discogs.com/search/?q=" + value.gtin +"&type=all'><i class='naranja fas fa-record-vinyl'></i></a></span>" : ""));
                $base.find("p.artist").text(value.from);
                $base.find("img.cover").attr("src", value.image);
                $.each(value.prices, function (index, value2) {
                  $base.find("table tbody").append("<tr><td>" + value2.text +
                    "</td><td><a href='" + value2.url + "'>" + value2.price + " " + value2
                    .currency + "</a></td><td>"+ value2.priceOriginal +"</td><td>" + (value2.priceInt === value.minPrice ?
                      "<i class='fas fa-star has-text-info	'></i>" : "") + "</td></div>");
                });
                $(".resultados").append($base);
              });
            }

            var htmlToSave = document.getElementById("div-resultados").innerHTML;

            sessionStorage.setItem('lastSearchResult', htmlToSave);
            sessionStorage.setItem('lastSearch', cadenaBusqueda);

            showSpinner(false);
          }

        });
    }

    document.addEventListener("DOMContentLoaded", function(event) { 

      getCurrencyRates()
        .then((salida) => {
          rates = salida;
        });
      //última búsqueda
      var lastSearchResult = sessionStorage.getItem('lastSearchResult');
      var lastSearch = sessionStorage.getItem('lastSearch');

      if (lastSearchResult != null){
        document.getElementById("div-resultados").innerHTML = lastSearchResult;
        document.getElementById("search").value = lastSearch;
      }

    });

    document.getElementById("formulario").addEventListener('submit', function(){

      cadenaBusqueda = $("#search").val()
                          .replace("VINILO", "")
                          .replace("VINYL", "")
                          .replace("CD", "")
                          .replace("LP","")
                          .replace(/ /g, '+');

      //Como mínimo 6 caracteres de búsqueda.
      if (cadenaBusqueda.length < 1)
        return false;

      cadenaBusqueda = cadenaBusqueda + "+LP";
      showSpinner(true);

      hideElement("div-info")
      hideElement("div-noresult");
      hideElement("div-resultados");

      $(".resultados-items").remove();
      discos = [];
      limiteAlcanzado = false;
      getAlbums(urlsDodax, cadenaBusqueda, 0);
      showElement("div-resultados");

      event.preventDefault();

    });

  </script>

</body>
</html>